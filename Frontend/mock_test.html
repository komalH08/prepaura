<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mock Test - Prepmate AI</title>

  <script src="face-api.min.js"></script>

  <!-- keep your css files as they were (they won't be removed) -->
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="practice-tool.css" />
  <link rel="stylesheet" href="managerial.css" />
  <link rel="stylesheet" href="mock_test.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/editor/editor.main.min.css" />

  <!-- Particle CDN -->
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

  <style>
    :root{
      --glass-bg: rgba(255,255,255,0.06);
      --glass-border: rgba(255,255,255,0.10);
      --accent-1:#38bdf8; --accent-2:#a78bfa;
      --btn-a:#2563eb; --btn-b:#1d4ed8;
      --card-radius:12px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Poppins",sans-serif;
      background:#0a192f;
      color:#e6eef9;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      overflow-x:hidden;
      position:relative;
    }

    /* Particles background */
    #particles-js{ position:fixed; inset:0; z-index:-1; background: linear-gradient(135deg,#0a192f,#1e3a8a,#1e40af); }

    /* Navbar (keep visible) */
    .navbar{
      position:fixed; top:0; left:0; right:0; height:64px; display:flex; align-items:center; justify-content:space-between;
      padding:0 22px; background:rgba(255,255,255,0.04); backdrop-filter: blur(12px); border-bottom:1px solid rgba(255,255,255,0.06); z-index:1000;
    }
    .nav-brand{ font-weight:700; font-size:1.4rem; background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent }
    .nav-links{ display:flex; gap:18px; list-style:none; margin:0; padding:0 }
    .nav-links a{ color:#dbeafe; text-decoration:none; padding:8px 10px; border-radius:6px }
    .nav-links a:hover{ color:#fff }

    /* Page layout */
    main.content{ padding: 100px 18px 60px; width:100%; display:flex; justify-content:center; }
    .container{ width:100%; max-width:1100px; margin:0 auto; }

    /* Shared glass panels */
    .glass {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--card-radius);
      padding: 22px;
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 30px rgba(2,6,23,0.45);
      transition: transform .28s ease, opacity .6s ease;
      opacity:0; transform: translateY(16px);
    }
    .glass.show{ opacity:1; transform: translateY(0) }

    /* Setup screen */
    #setup-screen h1, #ready-screen h1, #report-screen h1{ margin:0 0 8px; font-size:1.6rem; background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent }
    #setup-screen p, #ready-screen p{ color:#cbd5e1; margin:6px 0 14px; line-height:1.6 }

    .setup-grid{ display:grid; grid-template-columns: 1fr 320px; gap:18px; align-items:start; margin:12px 0 18px }
    .resume-uploader input[type=file]{ margin-top:12px }
    .language-select-box select{ padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:#111827; color:#e6eef9; width:100% }

    /* Buttons - match theme */
    .tool-button-primary, .tool-button-secondary { padding:10px 16px; border-radius:10px; cursor:pointer; border:none; font-weight:700 }
    .tool-button-primary{ background: linear-gradient(90deg,var(--btn-a),var(--btn-b)); color:#fff }
    .tool-button-secondary{ background: rgba(255,255,255,0.06); color:#dbeafe; border:1px solid rgba(255,255,255,0.04) }
    .tool-button-primary:disabled{ opacity:.6; cursor:not-allowed; transform:none; }

    /* Ready screen and test environment panels */
    #ready-screen .round-list{ text-align:left; margin:10px 0 16px; color:#e6eef9; line-height:1.6 }
    #test-environment .proctor-header {
      display:flex; gap:18px; align-items:center; justify-content:space-between;
      padding:14px; border-radius:10px; background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04); margin-bottom:16px;
    }
    #test-environment .proctor-header strong{ color:#cbd5e1; }
    #test-environment #round-content{ min-height:360px; padding:14px; border-radius:10px; background: rgba(3,7,18,0.4); border:1px solid rgba(255,255,255,0.03) }

    /* Report screen */
    #report-screen .response-box{ min-height:180px; padding:16px; background:#071028; border-radius:10px; color:#dbeafe; }

    /* Responsive tweaks */
    @media (max-width:900px){
      .setup-grid{ grid-template-columns: 1fr; }
      #test-environment .proctor-header{ flex-direction:column; align-items:flex-start; gap:8px }
    }
  </style>
</head>
<body>
  <!-- Particles -->
  <div id="particles-js"></div>

  <!-- Navbar (visible per request) -->
  <nav class="navbar" id="main-navbar">
    <div class="nav-brand">PrepAura AI</div>
    <ul class="nav-links" id="nav-links-list">
      <li><a href="home.html">Home</a></li>
      <li><a href="practice.html">Practice Hub</a></li>
      <li><a href="login.html">Logout</a></li>
    </ul>
  </nav>

  <main class="content" id="mock-test-container">
    <div class="container">

      <!-- Setup Screen (IDs preserved) -->
      <div id="setup-screen" class="glass">
        <h1>Final Mock Test</h1>
        <p>This is a full-length, proctored mock test that simulates a real company assessment in 4 rounds. The test will run in fullscreen, and switching tabs is restricted (warnings will be tracked).</p>

        <div class="setup-grid">
          <div class="resume-uploader" style="text-align: center; border-style: solid; padding: 18px; border-radius:10px;">
            <label for="resume-upload">**Step 1:** Upload Your Resume (PDF)</label>
            <input type="file" id="resume-upload" accept=".pdf" />
            <div style="margin-top:12px; display:flex; gap:10px; justify-content:center;">
              <button id="upload-btn" class="tool-button-primary" style="width:auto">Upload</button>
              <button id="skip-resume-btn" class="tool-button-secondary" style="width:auto">Skip</button>
            </div>
            <div id="resume-status" style="margin-top:8px; color:#cbd5e1"></div>
          </div>

          <div class="language-select-box">
            <label for="language-select"><strong>Step 2:</strong> Select Coding Language</label>
            <select id="language-select" class="tool-select">
              <option value="python">Python</option>
              <option value="java">Java</option>
            </select>
          </div>
        </div>

        <div style="display:flex; justify-content:center; margin-top:10px;">
          <button id="start-test-btn" class="tool-button-primary" disabled>Start Mock Test</button>
        </div>
      </div>

      <!-- Ready Screen -->
      <div id="ready-screen" class="glass hidden" style="margin-top:18px;">
        <h1>Test Structure</h1>
        <p>Your mock test consists of 4 rounds and will begin once you confirm. Leaving the tab more than 3 times may end the test.</p>
        <ul class="round-list">
          <li>Round 1: Aptitude Test (20 Qs, 30 Mins)</li>
          <li>Round 2: Communication Test (1 Min)</li>
          <li>Round 3: Coding Test (2 Qs, 45 Mins)</li>
          <li>Round 4: Live Interview (6 Qs)</li>
        </ul>
        <div style="display:flex; justify-content:center;">
          <button id="begin-test-btn" class="tool-button-primary">Begin Test Now</button>
        </div>
      </div>

      <!-- Test Environment -->
      <div id="test-environment" class="glass hidden" style="margin-top:18px;">
        <div class="proctor-header">
          <div class="proctor-info"><strong>Round:</strong> <span id="round-name">Aptitude</span></div>
          <div class="proctor-timer"><strong>Time Left:</strong> <span id="master-timer">30:00</span></div>
          <div class="proctor-warnings"><strong>Warnings:</strong> <span id="warning-count">0 / 3</span></div>
        </div>

        <div id="round-content">
          <!-- mock_test.js will render the round UI here (kept intact) -->
        </div>
      </div>

      <!-- Report Screen -->
      <div id="report-screen" class="glass hidden" style="margin-top:18px;">
        <h1>Mock Test Final Report</h1>
        <div class="response-box" id="final-report-box">
          Generating your comprehensive report...
        </div>
        <div style="margin-top:14px; display:flex; justify-content:center;">
          <a href="index.html" class="tool-button-primary" style="text-decoration:none; padding:10px 18px; border-radius:8px;">Back to Home</a>
        </div>
      </div>

    </div>
  </main>

  <!-- Keep existing script includes (unchanged) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
  <script src="mock_test.js"></script>
  <script src="auth.js"></script>

  <!-- Particles configuration & show animations -->
  <script>
    particlesJS("particles-js", {
      particles: {
        number: { value: 75, density:{ enable:true, value_area: 800 } },
        color: { value: "#38bdf8" },
        shape: { type: "circle" },
        opacity: { value: 0.55 },
        size: { value: 3, random: true },
        line_linked: {
          enable: true,
          distance: 140,
          color: "#60a5fa",
          opacity: 0.36,
          width: 1
        },
        move: {
          enable: true,
          speed: 2.2,
          direction: "none",
          random: false,
          straight: false,
          out_mode: "out",
          bounce: false
        }
      },
      interactivity: {
        detect_on: "canvas",
        events: {
          onhover: { enable: true, mode: "grab" },
          onclick: { enable: true, mode: "push" },
          resize: true
        },
        modes: {
          grab: { distance: 220, line_linked: { opacity: 0.92 } },
          repulse: { distance: 120, duration: 0.4 },
          push: { particles_nb: 4 }
        }
      },
      retina_detect: true
    });

    // show animation helper: reveal the currently visible panel when class 'hidden' removed by mock_test.js
    const observer = new MutationObserver(muts => {
      muts.forEach(m => {
        if (m.type === 'attributes' && (m.attributeName === 'class' || m.attributeName === 'style')) {
          const el = m.target;
          if (!el.classList.contains('hidden')) {
            el.classList.add('show');
          }
        }
      });
    });

    // observe panels (setup, ready, test env, report)
    ['setup-screen','ready-screen','test-environment','report-screen'].forEach(id=>{
      const el = document.getElementById(id);
      if(el) observer.observe(el,{ attributes:true, childList:false, subtree:false });
      // ensure setup visible on load:
      if(id==='setup-screen' && el) el.classList.add('show');
    });

    // ensure any future switched-in panels reveal smoothly (in case mock_test.js toggles 'hidden')
  </script>
</body>
</html>
